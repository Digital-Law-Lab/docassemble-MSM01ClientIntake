#This includes the code from the other interviews
include:
  - Config.yml
  - Wills_Estates_Questions.yml
  - Migration_Questions.yml
---
mandatory: True
code: |
  target = 'normal'
  multi_user = True
---
#This is the code screen that drives the interview process
mandatory: True
scan for variables: False
code: |
  # Don't show save and resume link yet
  show_save_resume_message = False

  # Show welcome screen 
  MSM_Screen_Welcome

  # Program will exit if user clicked 'I do not accept' at previous screen, so the following will only run if user agreed (ie clicked on the button with the value `proceed`)


  #This now sets the show save resume link to True (so it appears)
  show_save_resume_message = True
  if target == 'save_and_resume':
    # check if user want to save their answers
    if wants_save_and_resume_email:
      # if yes, try to send the link via email to the temporary address.
      if save_email_sent:
        log("We sent an email to your email address. You can safely close this window now!", "info")
      else:
        log("There was a problem with emailing.", "danger")
      show_save_resume_message = False
    undefine('wants_save_and_resume_email')
    undefine('save_email_sent')
    target = 'normal'

  # check if client requires an interpreter
  MSM_User_needs_interpreter

  # there are two pathways that depend on the selected legal issue
  if MSM_Screen_LegalIssue == 'Wills, Estates and Probate':
    MSM_Pathway_Wills
  elif MSM_Screen_LegalIssue == 'Migration':
    MSM_Pathway_Migration

  # disable save and resume button
  show_save_resume_message = False  
  # display thank you screen
  MSM_Screen_Final

---
#This is the initial welcome screen that explains what the application does
question: Welcome to MSM Legal
subquestion: |
  The information you provide to [MSM Legal](https://www.msmlegal.com.au/) will help assign the best staff member to assist you in your matter.

  **Disclaimer**

  - Any information obtained as part of this form is not legal advice and must not be used as a substitute for legal advice.

  - All information collected by this form is collected in accordance with the **Privacy Act 1988 (Cth)** and the [**MSM Legal Privacy Policy**](https://www.msmlegal.com.au/privacy/).

field: MSM_Screen_Welcome
buttons:
  - I do not accept: exit
    color: danger
  - I accept and want to continue: proceed
---
#This is the ESL question
question: |
  Do you need an interpreter?
subquestion: |
fields:
  - no label: MSM_User_needs_interpreter
    datatype: yesnoradio
  - Language: MSM_User_language
    # TODO: generate a dropdown menu of common lanugages, I tried pycountry.languages but the list is over 7000
    show if: MSM_User_needs_interpreter
---
#This asks what legal issue the user has
question: What is your legal issue?
fields:
  - no label: MSM_Screen_LegalIssue
    datatype: radio
    choices:
      - 'Migration'
      - 'Wills, Estates and Probate'
---
# This is code for the save and resume function
default screen parts:
  under: |
    % if show_save_resume_message:
    [Save and resume later](${ url_action('save_and_resume') })
    % endif
---
event: save_and_resume
code: |
  target = 'save_and_resume'
---
# Store information about MSM Legal in this object
objects:
  - MSMLegal: Individual
  - MSMLegal_noreply: Individual
---
# This block sets the information for MSM Legal
code: |
  # Name
  MSMLegal.name.uses_parts = False
  MSMLegal.name.text = "MSM Legal"

  # Contact phone
  MSMLegal.phone_number = '+61 8 8161 5088'

  # Email addresses
  MSMLegal.email = 'mail@msmlegal.com.au'
---
# This sets for MSMLegal_noreply.
# For some reason send_email() wants name.first (instead of name.text)
code: |
  MSMLegal_noreply.name.first = 'MSM Legal No Reply'
  MSMLegal_noreply.email = 'noreply@dll.org.au'
---

#This is the question block displayed during the interview if the user clicks save and resume on one of the questions
question: |
  How to resume your interview later
subquestion: |
  If you want to resume your interview later, we can
  e-mail you a link that you can click on to resume
  your interview at a later time.
fields:
  - no label: wants_save_and_resume_email
    input type: radio
    choices:
      - 'Ok, email me': True
      - 'No thanks': False
  - Email address: user_email_address_for_save
    datatype: email
    show if: wants_save_and_resume_email
---
# This controls what is displayed in the email sent to the user if they wish to save and resume
template: MSM_Template_Email_saveResume
subject: |
  MSM Legal Enquiry - Saved Answers
content: |
  <div style="font-family: Times New Roman; line-height: 1.5em;">
  <p>Hello,</p>
  <p>To resume your MSM Legal enquiry please <a href="${ interview_url() }">click here</a></p>
  <p>Please note this link will expire in 90 days from today.</p>
  <p>Should you have any questions or concerns, please do not hesitate to contact us on ${MSMLegal.phone_number} or via email at ${MSMLegal.email}</p>
  <p>Kind Regards, </p>
  <p>MSM Legal</p>
  </div>
---
# This is the final screen for both pathways
prevent going back: True
event: MSM_Screen_Final
question: Thank you for contacting us
subquestion: |
  Your responses have been sent to MSM Legal.  You will be contacted shortly.

  A confirmation email has also been sent to you along with a copy of your responses.

buttons:
  - Exit: exit
    url: https://www.msmlegal.com.au/
  - Restart: restart
---
# Confirmation email template that the user will recieve upon submission
template: MSM_Template_Email_ReceiptConfirmation
subject: |
  MSM Legal Enquiry Received
content: |
  ${MSMLegal_Email_Styles}

  <p class="MsoNormal">Hi ${ user.name }, </p>
  <p class="MsoNormal">Thank you for contacting MSM Legal regarding your matter. We have received your enquiry and one of our team members will be in touch shortly.</p>
  <p class="MsoNormal">For your reference, please find attached a copy of what we have recieved.</p>
  <p class="MsoNormal">Should you have any questions or concerns, please do not hesitate to contact us on ${MSMLegal.phone_number} or via email at ${MSMLegal.email}</p>
  <p class="MsoNormal">Kind Regards,</p>

  ${MSMLegal_Email_Signature}
---