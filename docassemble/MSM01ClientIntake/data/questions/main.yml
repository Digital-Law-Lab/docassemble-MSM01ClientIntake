#This includes the code from the other interviews
include:
  - Config.yml
  - Wills_Estates_Questions.yml
  - Migration_Questions.yml
  - Colour_Scheme.yml
---
mandatory: True
code: |
  target = 'normal'
  show_save_resume_message = False
  multi_user = True
---
#This is the code screen that drives the interview process
mandatory: True
scan for variables: False
code: |
  # Show welcome screen 
  MSM_Screen_Welcome

  # Program will exit if user clicked 'I do not accept' at previous screen, so the following will only run if user agreed (ie clicked on the button with the value `proceed`)


  #This now sets the show save resume link to True (so it appears)
  #However, it only shows in the Wills, Estates and Probate side
  #You will need to reimplement this on the other branch for Migration
  show_save_resume_message = True
  if target == 'save_and_resume':
    if wants_save_and_resume_email:
      if save_email_sent:
        log("We sent an e-mail to your e-mail address.", "info")
      else:
        log("There was a problem with e-mailing.", "danger")
      show_save_resume_message = False
    undefine('wants_save_and_resume_email')
    undefine('save_email_sent')
    target = 'normal'

  # check if client requires an interpreter
  MSM_User_needs_interpreter

  # there are two pathways that depend on the selected legal issue
  if MSM_Screen_LegalIssue == 'Wills, Estates and Probate':
    WE_review_answers
    WE_final_screen
  elif MSM_Screen_LegalIssue == 'Migration':
    if is_user_main_applicant == 'Yes':
      M_user_review_answers
    elif is_user_main_applicant == 'No':
      M_main_app_review_answers
    M_final_screen

---
#This is the initial welcome screen that explains what the application does
question: Welcome to MSM Legal
subquestion: |
  The information you provide to [MSM Legal](https://www.msmlegal.com.au/) will help assign the best staff member to assist you in your matter.

  **Disclaimer**

  - Any information obtained as part of this form is not legal advice and must not be used as a substitute for legal advice.

  - All information collected by this form is collected in accordance with the **Privacy Act 1988 (Cth)** and the [**MSM Legal Privacy Policy**](https://www.msmlegal.com.au/privacy/).

field: MSM_Screen_Welcome
buttons:
  - I do not accept: exit
    color: danger
  - I accept and want to continue: proceed
---
#This is the ESL question
question: |
  Do you need an interpreter?
subquestion: |
fields:
  - no label: MSM_User_needs_interpreter
    datatype: radio
    choices:
      - Yes
      - No
  - Language: MSM_User_language
    # TODO: generate a dropdown menu of common lanugages, I tried pycountry.languages but the list is over 7000
    show if:
      variable: MSM_User_needs_interpreter
      is: Yes
---
#This asks what legal issue the user has
question: What is your legal issue?
fields:
  - no label: MSM_Screen_LegalIssue
    datatype: radio
    choices:
      - 'Migration'
      - 'Wills, Estates and Probate'
---
# This is code for the save and resume function
default screen parts:
  under: |
    % if show_save_resume_message:
    [Save and resume later](${ url_action('save_and_resume') })
    % endif
---
#This is the main code for the save and resume function
scan for variables: False
code: |
  if target == 'save_and_resume':
    if wants_save_and_resume_email:
      if save_email_sent:
        log("We sent an e-mail to your e-mail address.", "info")
      else:
        log("There was a problem with e-mailing.", "danger")
      show_save_resume_message = False
    undefine('wants_save_and_resume_email')
    undefine('save_email_sent')
    target = 'normal'
  M_final_screen or WE_final_screen
---
event: save_and_resume
code: |
  target = 'save_and_resume'
---
code: |
  send_email(to=user_email_address_for_save, template=save_resume_template)
  save_email_sent = True
---
#This is the question block displayed during the interview if the user clicks save and resume on one of the questions
question: |
  How to resume your interview later
subquestion: |
  If you want to resume your interview later, we can
  e-mail you a link that you can click on to resume
  your interview at a later time.
fields:
  - no label: wants_save_and_resume_email
    input type: radio
    choices:
      - 'Ok, e-mail me': True
      - 'No thanks': False
    default: True
  - E-mail address: user_email_address_for_save
    datatype: email
    show if: wants_save_and_resume_email
under: ''
---
# This controls what is displayed in the email sent to the user if they wish to save and resume
template: save_resume_template
subject: |
  MSM Legal Interview - Your Saved Answers
content: |
  Dear User,

  To resume your MSM Legal interview please
  [click here](${ interview_url() }).

  Please note this link will expire in 90 days from today.

  Should you have any questions or concerns, please do not hesitate to contact us on (08) 8161 5088 or via email at mail@msmlegal.com.au

  Kind Regards, 

  MSM Legal
---

